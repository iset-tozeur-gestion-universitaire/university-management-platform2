<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Test Connexion Frontend-Backend</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-8">
    <div class="max-w-5xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-6">
            <h1 class="text-4xl font-bold mb-4 text-indigo-600">ğŸ§ª Test de Connexion API</h1>
            <p class="text-gray-600 mb-6">VÃ©rification de la connexion entre Frontend (Port 3004) et Backend (Port 3000)</p>
            
            <div class="flex gap-4 mb-6">
                <button onclick="runAllTests()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-3 rounded-lg transition duration-200 shadow-md">
                    ğŸš€ Lancer Tous les Tests
                </button>
                <button onclick="clearResults()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold px-6 py-3 rounded-lg transition duration-200 shadow-md">
                    ğŸ—‘ï¸ Effacer
                </button>
            </div>

            <div id="status" class="text-center text-xl font-semibold mb-4"></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">ğŸ“Š RÃ©sultats des Tests</h2>
                <div id="results" class="space-y-2"></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">ğŸ“ˆ Statistiques</h2>
                <div id="stats" class="space-y-3"></div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">ğŸ“ DonnÃ©es RÃ©cupÃ©rÃ©es</h2>
            <div id="data" class="space-y-4 max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';
        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                error: 'text-red-600'
            };
            statusDiv.className = `text-center text-xl font-semibold mb-4 ${colors[type]}`;
            statusDiv.textContent = message;
        }

        function addResult(name, success, message, count = null) {
            testResults.total++;
            if (success) testResults.passed++;
            else testResults.failed++;

            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `p-4 rounded-lg ${success ? 'bg-green-50 border-l-4 border-green-500' : 'bg-red-50 border-l-4 border-red-500'}`;
            div.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <strong class="${success ? 'text-green-800' : 'text-red-800'}">${success ? 'âœ…' : 'âŒ'} ${name}</strong>
                        <p class="text-sm ${success ? 'text-green-600' : 'text-red-600'}">${message}</p>
                    </div>
                    ${count !== null ? `<span class="text-2xl font-bold ${success ? 'text-green-600' : 'text-red-600'}">${count}</span>` : ''}
                </div>
            `;
            resultsDiv.appendChild(div);
            updateStats();
        }

        function updateStats() {
            const statsDiv = document.getElementById('stats');
            const percentage = testResults.total > 0 ? Math.round((testResults.passed / testResults.total) * 100) : 0;
            statsDiv.innerHTML = `
                <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                    <span class="font-semibold text-gray-700">Tests Total</span>
                    <span class="text-2xl font-bold text-blue-600">${testResults.total}</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <span class="font-semibold text-gray-700">Tests RÃ©ussis</span>
                    <span class="text-2xl font-bold text-green-600">${testResults.passed}</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                    <span class="font-semibold text-gray-700">Tests Ã‰chouÃ©s</span>
                    <span class="text-2xl font-bold text-red-600">${testResults.failed}</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-indigo-50 rounded-lg">
                    <span class="font-semibold text-gray-700">Taux de RÃ©ussite</span>
                    <span class="text-2xl font-bold text-indigo-600">${percentage}%</span>
                </div>
            `;
        }

        function displayData(title, data, icon) {
            const dataDiv = document.getElementById('data');
            const div = document.createElement('div');
            div.className = 'border-l-4 border-indigo-500 bg-indigo-50 pl-4 pr-4 py-3 rounded-r-lg';
            
            const preview = Array.isArray(data) ? data.slice(0, 3) : [data];
            div.innerHTML = `
                <h3 class="font-bold text-lg mb-2 text-indigo-800">${icon} ${title} (${Array.isArray(data) ? data.length : 1} Ã©lÃ©ment${Array.isArray(data) && data.length > 1 ? 's' : ''})</h3>
                <pre class="bg-white p-3 rounded text-sm overflow-auto border border-indigo-200">${JSON.stringify(preview, null, 2)}</pre>
            `;
            dataDiv.appendChild(div);
        }

        async function testEndpoint(name, url, icon) {
            try {
                updateStatus(`ğŸ”„ Test en cours: ${name}...`, 'info');
                const response = await fetch(`${API_URL}${url}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const count = Array.isArray(data) ? data.length : 1;
                    addResult(name, true, `${count} Ã©lÃ©ment${count > 1 ? 's' : ''} rÃ©cupÃ©rÃ©${count > 1 ? 's' : ''}`, count);
                    displayData(name, data, icon);
                    return { success: true, count, data };
                } else {
                    addResult(name, false, `Erreur HTTP ${response.status}: ${response.statusText}`);
                    return { success: false, error: response.statusText };
                }
            } catch (error) {
                addResult(name, false, `Erreur rÃ©seau: ${error.message}`);
                return { success: false, error: error.message };
            }
        }

        async function runAllTests() {
            clearResults();
            updateStatus('ğŸš€ DÃ©marrage des tests...', 'info');
            
            const tests = [
                { name: 'Ã‰tudiants', url: '/etudiants', icon: 'ğŸ“' },
                { name: 'Enseignants', url: '/enseignant', icon: 'ğŸ‘¨â€ğŸ«' },
                { name: 'DÃ©partements', url: '/departement', icon: 'ğŸ›ï¸' },
                { name: 'Classes', url: '/classe', icon: 'ğŸ“š' },
                { name: 'SpÃ©cialitÃ©s', url: '/specialite', icon: 'ğŸ¯' }
            ];

            for (const test of tests) {
                await testEndpoint(test.name, test.url, test.icon);
                await new Promise(resolve => setTimeout(resolve, 500)); // Pause entre les tests
            }

            const allPassed = testResults.failed === 0;
            updateStatus(
                allPassed 
                    ? 'ğŸ‰ Tous les tests ont rÃ©ussi ! La connexion fonctionne parfaitement !' 
                    : `âš ï¸ ${testResults.failed} test(s) Ã©chouÃ©(s) sur ${testResults.total}`,
                allPassed ? 'success' : 'error'
            );
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('data').innerHTML = '';
            document.getElementById('stats').innerHTML = '';
            testResults = { passed: 0, failed: 0, total: 0 };
            updateStatus('PrÃªt Ã  tester', 'info');
        }

        // Lancer les tests automatiquement au chargement
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>
